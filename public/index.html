<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Control Angular</title>
  </head>
  <body>
    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>
    <script>
      let currentAzimuth = 0;
      let currentAltitude = 0;

      const knobAzimuth = new Protobject.Knob({ min: -1000, max: 1000 });
      const knobAltitude = new Protobject.Knob({ min: -1000, max: 1000 });

      // Envia ambos valores juntos a la placa
      function sendToPlaca() {
        Protobject.Core.send({
          azimuth: currentAzimuth,
          altitude: currentAltitude,
        }).to("placa.html");
        console.log("Enviado a placa:", {
          azimuth: currentAzimuth,
          altitude: currentAltitude,
        });
      }

      knobAzimuth.onChange((az) => {
        currentAzimuth = az;
        sendToPlaca();
      });

      knobAltitude.onChange((alt) => {
        currentAltitude = alt;
        sendToPlaca();
      });

      window.addEventListener("message", (event) => {
        const { type, azimuth, altitude } = event.data || {};
        if (type === "knob-move") {
          if (typeof azimuth === "number") {
            knobAzimuth.setValue(azimuth);
            currentAzimuth = azimuth;
          }
          if (typeof altitude === "number") {
            knobAltitude.setValue(altitude);
            currentAltitude = altitude;
          }
          sendToPlaca(); // Enviar ambos siempre que llegue un mensaje
        }
      });
    </script>
  </body>

  <style>
    #ProtobjectPlusButton {
      width: 80px !important;
    }

    #ProtobjectPlusButton:after {
      content: " Connect";
    }
  </style>
</html>
