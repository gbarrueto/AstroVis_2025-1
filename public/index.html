<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lamp</title>
  </head>
  <body>
    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>
    <script>
      let lastCallback = null;

      const perilla = new Protobject.Knob({ min: -1500, max: 1500 });

      perilla.onChange((value) => {
        lastCallback = (value) =>
          Protobject.Core.send({ speed: value }).to("placa.html");
        lastCallback(value);
      });

      window.addEventListener("message", (event) => {
        if (event.data?.type === "knob-move") {
          const newValue = event.data.value;
          perilla.setValue(newValue);
          if (lastCallback) lastCallback(newValue);
        }
      });
    </script>
  </body>
  <style>
    #ProtobjectPlusButton {
      width: 80px !important;
    }

    #ProtobjectPlusButton:after {
      content: " Connect";
    }

    .ProtobjectKnob {
      display: none !important;
    }
  </style>
</html>
